MU={},function($,MU){"use strict";var Button=function(element){this.element=$(element),this.label=this.element.find("span"),this.label.length||(this.element.text("<span>"+this.element.text()+"</span>"),this.label=this.element.find("span")),this.originalContent={content:"",disabled:null}};Button.prototype={constructor:Button,element:function(){return this.element},on:function(evnt,call){return this.element.on(evnt,call)},off:function(evnt){return this.element.off(evnt)},disabled:function(state){return"undefined"==typeof state?(state=this.element.attr("disabled"),"true"===state||"disabled"===state):void(state?this.element.attr("disabled",!0):this.element.removeAttr("disabled"))},pressed:function(state){return"undefined"==typeof state?this.element.hasClass("pressed"):void(state?this.element.addClass("pressed"):this.element.removeClass("pressed"))},style:function(variant){var classes="alt primary attention";if("undefined"==typeof variant){for(var i=classes.split(" ").length-1;i>=0;i--)if(this.element.hasClass(classes[i]))return classes[i];return"default"}this.element.removeClass(classes),"default"!==variant&&this.element.addClass(variant)},label:function(text){return"undefined"==typeof text?this.label.text():void this.label.text(text)},busy:function(state,label){if("undefined"==typeof state)return this.element.hasClass("busy");if(state){if(this.busy())return;this.element.addClass("busy"),this.originalContent.content=this.element.html(),this.originalContent.disabled=this.disabled(),this.element.html(" "+(label?label:this.label())),this.icon("spinner","left",!0),this.disabled(!0)}else{if(!this.busy())return;this.element.removeClass("busy"),this.element.html(this.originalContent.content),this.disabled(this.originalContent.disabled)}},icon:function(name,position,spin){var icon=this.element.find("i");return"undefined"==typeof name?icon.length?icon.attr("class").match(/fa-([a-z\-]+)/)[1]:!1:(icon.remove(),void(name&&this.element["right"===position?"append":"prepend"]("<i></i>").find("i").removeClass().addClass("fa fa-"+name+(spin?" fa-spin":""))))}},MU.Button=Button}(Zepto,MU),function($,MU){"use strict";function getGeometery(parent,padding){return{top:parent.offset().top-padding,left:parent.offset().left-padding,width:parent.width()+2*padding,height:parent.height()+2*padding}}var count=0,Overlay=function(parent,options){var that=this;this.options=$.extend({},{loading:!1,text:null,padding:0,canClose:!1,onClick:!1,id:null,classes:[]},options),this.element=$('<div class="overlay" />'),parent?this.parent=$(parent):(this.options.classes.push("expanded"),this.parent=!1),this.options.text&&this.element.append("<div class=text>"+this.options.text+"</div>"),this.options.loading&&(this.options.classes.push("loading"),this.element.append('<i class="fa spinner fa-spinner fa-spin"></i>')),this.options.id||(this.options.id="mu-overlay-"+count),this.element.attr("id",this.options.id),this.options.classes.length&&this.element.addClass(this.options.classes.join(" ")),this.options.canClose&&this.element.on("click",that.hide),this.isVisible=!1,this.isAppended=!1,this.resize={timer:!1,event:!1},count+=1};Overlay.prototype={constructor:Overlay,onClick:function(callback){return"function"==typeof callback?this.element.on("click.callback",callback):this.element.unbind("click.callback"),this},update:function(animated,geometry){!geometry&&this.parent&&(geometry=getGeometery(this.parent,this.options.padding)),"object"==typeof geometry&&this.element[animated?"animate":"css"]({top:geometry.top,left:geometry.left,width:geometry.width,height:geometry.height})},show:function(geometry){var that=this;(!this.parent||this.parent.is(":visible"))&&(this.isVisible||(!geometry&&this.parent&&(geometry=getGeometery(this.parent,this.options.padding)),"object"==typeof geometry&&this.element.css({display:"none",top:geometry.top,left:geometry.left,width:geometry.width,height:geometry.height,position:"absolute"}),this.parent&&(this.resize.event=$(window).on("resize",function(){that.resize.timer&&clearTimeout(that.resize.timer),that.resize.timer=setTimeout(function(){that.update(!1),console.log("Fire!!")},200)})),"function"==typeof this.options.onClick&&(this.onClick=this.options.onClick),this.isVisible=!0,this.isAppended||(this.element.appendTo("body"),this.isAppended=!0),this.element.fadeIn()))},hide:function(){this.isVisible=!1,this.element.fadeOut(),this.resize.event&&($(window).off(this.resize.event),this.resize.event=!1)}},MU.Overlay=Overlay}(Zepto,MU),function(MU){"use strict";var Aarray=function(){this.stack={},this.idsStack=[]};Aarray.prototype={construct:Aarray,push:function(id,panel){return this.stack[id]=panel,this.idsStack.push(id),this.idsStack.length-1},pushAfter:function(afterId,id,panel){var indexTo=this.getIndex(afterId)+1;return this.stack[id]=panel,this.idsStack.splice(indexTo,0,id),indexTo},remove:function(id){delete this.stack[id],this.idsStack.splice(this.getIndex(id),1)},getIndex:function(id){if("function"==typeof this.idsStack.indexOf)return this.idsStack.indexOf(id);for(var i=this.idsStack.length-1;i>=0;i--)if(this.idsStack[i]===id)return i},getIndexFrom:function(id,step){return id=this.getIndex(id),id!==!1&&id>0?id+step:void 0},get:function(id){return void 0!==typeof this.stack[id]?this.stack[id]:!1},getFrom:function(id,step){return id=this.getIndexFrom(id,step),id!==!1?this.get(this.idsStack[id]):!1},count:function(){return this.idsStack.length},getLast:function(){return this.stack[this.idsStack[this.idsStack.length-1]]},each:function(callback){for(var r,i=0;i<this.idsStack.length;i++)if(r=callback(i,this.stack[this.idsStack[i]]),void 0!==r)return r},eachAfter:function(id,callback){for(var r,i=this.getIndex(id)+1;i<this.idsStack.length;i++)if(r=callback(i,this.stack[this.idsStack[i]]),void 0!==r)return r},eachBefore:function(id,callback){for(var r,i=0;i<this.getIndex(id);i++)if(r=callback(i,this.stack[this.idsStack[i]]),void 0!==r)return r}},MU.Aarray=Aarray}(MU),function(MU){"use strict";MU.Calc={numberFormat:function(number,decimals,dec_point,thousands_sep){number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+number)?+number:0,prec=isFinite(+decimals)?Math.abs(decimals):0,sep="undefined"==typeof thousands_sep?",":thousands_sep,dec="undefined"==typeof dec_point?".":dec_point,s="",toFixedFix=function(n,prec){var k=Math.pow(10,prec);return""+Math.round(n*k)/k};return s=(prec?toFixedFix(n,prec):""+Math.round(n)).split("."),s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)),(s[1]||"").length<prec&&(s[1]=s[1]||"",s[1]+=new Array(prec-s[1].length+1).join("0")),s.join(dec)},getPercent:function(amount,total,percision){var count;return"number"==typeof amount&&"number"==typeof total?(percision=percision||2,amount&&total?(count=amount/total,count=100*count,count=parseFloat(this.numberFormat(count,percision))):amount):!1},setPercent:function(percent,total,percision){return"number"==typeof percent&&"number"==typeof total?(percision=percision||2,percent&&total?parseFloat(this.numberFormat(total/100*percent,percision)):0):!1}}}(MU),function($,MU){"use strict";var PanelSide=function(options){options=$.extend({},{header:!0,style:null,content:null,footer:!1},options),this.element=$('<div class="side panel" />'),this._s={},this._s.headerItems={left:0,right:0},options.header&&this.header(!0),options.style&&this.style(options.style)};PanelSide.prototype={constructor:PanelSide,header:function(value){return void 0===value?this.element.find("header.main"):void(value?this.header().length||this.element.prepend('<header class="main"><h2></h2></header>'):this.element.remove("header.main"))},header_add:function(id,options){var element,pos=0,_this=this,action=options.action,preventDefault=options.preventDefault;switch(options.type){case"link":element=$('<a href="#" />');break;case"title":element=$("<h2/>");break;default:throw new Error("Invalid type: "+options.type)}action&&element.on("click",function(e){preventDefault&&(e.preventDefault(),e.stopPropagation()),_this.element.trigger(action)}),options.icon&&element.append('<i class="fa fa-'+options.icon+'" />'),options.label&&element.append("<span>"+options.label+"</span>"),"title"!==options.type&&(options.position="right"===options.position?"right":"left",pos=++this._s.headerItems[options.position],pos=1===pos?20*pos:25*pos,element.css(options.position,pos+"px")),element.appendTo(this.header())},footer:function(value){return void 0===value?this.element.find("footer.main"):void(value?this.footer().length||this.element.append('<footer class="main"><h2></h2></footer>'):this.element.remove("footer.main"))},style:function(variant){var classes="alt";if("undefined"==typeof variant){for(var i=classes.split(" ").length-1;i>=0;i--)if(this.element.hasClass(classes[i]))return classes[i];return"default"}this.element.removeClass(classes),"default"!==variant&&this.element.addClass(variant)},appendTo:function(parent){this.element.appendTo(parent)}},MU.PanelSide=PanelSide}(Zepto,MU),function($,MU){"use strict";var count=0,dimensions={tiny:160,small:260,medium:500,big:800,full:0},Panel=function(options){options=$.extend({},{size:"small",expand:!1,flippable:!1,closable:!0,shrink:!1,id:!1,position:0},options),this._s={},this._s.position=options.position,this._s.offset=0,this._s.locked=!1,this._s.expand=options.expand,this.shrink(options.shrink?options.shrink:!1),this._s.expandedFor=0,this._s.size=0,this.size(options.size),this._s.children=[],this._s.away=!1,this._s.awayOnBlur=!1,this._s.awayWidth=10,this._s.insensitive=!1,this._s.busy=!1,this.element=function(){var wrapper=$('<div class="panel multi" />'),sides=$('<div class="sides" />').appendTo(wrapper);return wrapper.width(this._s.width?this._s.width+"px":"100%"),this.front=new MU.PanelSide(options.front),this.front.style("front"),options.closable&&this.front.header_add("close",{icon:"times",type:"link",action:"self/close",preventDefault:!0}),options.front.title&&this.front.header_add("title",{label:options.front.title,type:"title"}),sides.append(this.front.element),options.flippable?(this.back=new MU.PanelSide(options.back),this.back.style("back alt"),this.back.header_add("close",{icon:"arrow-left",type:"link",action:"self/flip"}),options.back.title&&this.back.header_add("title",{label:options.front.title,type:"title"}),sides.append(this.back.element)):(this.back=!1,sides.append('<div class="dummy"/>')),wrapper}.call(this),this.id(options.id?options.id:"mu-panel-"+count),this.closing=!1,count++};Panel.prototype={constructor:Panel,flip:function(){this.back&&this.element.toggleClass("flipped")},away:function(value,refresh){var width;if(void 0===value)return this._s.away;if(value){if(this.focus()||this._s.away)return void(this._s.awayOnBlur=!0);this._s.away=!0,width=-(this.width()-this._s.awayWidth)}else{if(!this._s.away)return void(this._s.awayOnBlur=!1);this._s.away=!1,this._s.awayOnBlur=!1,width=this.width()-this._s.awayWidth}$(document).trigger("MU/panels/updateSum",[width]),(void 0===refresh||refresh===!0)&&$(document).trigger("MU/panels/refresh")},insensitive:function(value){return void 0===value?this._s.insensitive:void(value?this.focus()?(this.focus(!1),this._s.insensitive=!0,$(document).trigger("MU/panels/focusNext",[this.id()])):this._s.insensitive=!0:this._s.insensitive=!1)},busy:function(value){if(void 0===value)return this._s.busy;if(value){if(this._s.busy)return;var busy=$('<div class="loading panel-busy" style="opacity:0;" />').prependTo(this.element);busy.animate({opacity:.75}),this._s.busy=!0}else{if(!this._s.busy)return;this.element.find("div.panel-busy").fadeOut(400,function(){this.remove()}),this._s.busy=!1}},animate:function(){this.closing||this.element.animate({left:this._s.position+this._s.offset,width:this.width+this._s.expandedFor,opacity:1},400,"ease")},locked:function(value){return void 0===value?this._s.locked:void(this._s.locked=!!value)},offset:function(offset){return void 0===offset?this._s.offset:void(this._s.offset=offset)},position:function(position){return void 0===position?this._s.position:void(this._s.position=position)},expand:function(value){return void 0===value?this._s.expand:void(this._s.expand=!!value)},expandFor:function(width){return void 0===width?this._s.expandedFor:void(this._s.expandedFor=width)},shrink:function(value){return void 0===value?this._s.shrink:void(this._s.shrink=value===!1?!1:dimensions[value]?dimensions[value]:dimensions.tiny)},size:function(value){return void 0===value?this._s.width:(this._s.size="undefined"==typeof dimensions[value]?"small":value,void(this._s.width=dimensions[this._s.size]))},width:function(){return this._s.width},id:function(id){return void 0===id?this.element.prop("id"):void this.element.prop("id",id)},addChild:function(child){this._s.children.push(child)},getChildren:function(){return this._s.children},zIndex:function(value){return void 0===value?this.element.css("z-index"):void this.element.css({"z-index":value})},focus:function(state){return this.insensitive()?void 0:void 0===state?this.element.hasClass("selected"):void(state?(this.element.addClass("selected"),this.away()&&(this.away(!1,!1),this._s.awayOnBlur=!0)):(this.element.removeClass("selected"),this._s.awayOnBlur&&this.away(!0,!1)))}},MU.Panel=Panel}(Zepto,MU),function($,MU){"use strict";var Panels=function(parent){var _this=this;this.parent=$(parent),this.sumSize=0,this.fillCount=0,this.activeId=!1,this.offseted=!1,this.panelsStack=new MU.Aarray,this.innerWidth=!1,this.parent.on("click","div.panel.multi",function(){_this.focus(this.id,!0)}),this.parent.on("self/close","div.panel.multi",function(){_this.remove(this.id)}),$(document).on("MU/panels/refresh",function(){_this.refreshView()}),$(document).on("MU/panels/updateSum",function(e,value){_this.updateSum(value)}),$(document).on("MU/panels/focusNext",function(e,lastId){_this.focusNext(lastId),_this.refreshView()})};Panels.prototype={constructor:Panels,updateSum:function(value){this.sumSize=this.sumSize+value},refreshView:function(resized){if((resized||this.innerWidth===!1)&&(this.innerWidth=this.parent.width()),this.activeId){var overflow=this.innerWidth-this.sumSize,overflowPart=this.fillCount>0?Math.ceil(overflow/this.fillCount):0,activePanel=this.panelsStack.get(this.activeId),screenLeft=this.innerWidth-activePanel.width(),overflowPercent=100-MU.Calc.getPercent(screenLeft,this.sumSize-activePanel.width()),offsetSoFar=0,panelCalculated=0;0>=overflowPart&&(overflowPart=overflow),overflow>0?(overflowPercent=0,this.offseted=!1):this.offseted=!0,this.panelsStack.each(function(index,panel){if(panel.away()&&!panel.focus())return panel.expandFor(0),panel.offset(-1*(panel.width()-panel._s.awayWidth+offsetSoFar)),panel.animate(),void(offsetSoFar+=panel.width()-panel._s.awayWidth);if("full"===activePanel.size())return void("full"!==panel.size()?(offsetSoFar+=panel.width(),panel.offset(-1*offsetSoFar)):panel.offset(-1*offsetSoFar));if(panel.expand()){if(overflow>0)return panel.offset(-1*offsetSoFar),panel.expandFor(overflowPart),panel.animate(),void(offsetSoFar+=-1*overflowPart);panel.expandFor(0),panel.animate()}if(panel.focus())return panel.expandFor(0),panel.offset(-1*offsetSoFar),void panel.animate();if(panelCalculated=MU.Calc.setPercent(overflowPercent,panel.width()),panel.shrink()&&panel.width()+panel._s.expandedFor>panel.shrink()){if(panel.shrink()>panel.width()-panelCalculated){var diff=panelCalculated-(panel.width()-panel.shrink());return panel.expandFor(-1*diff),panel.offset(-1*(panelCalculated-diff+offsetSoFar)),panel.animate(),void(offsetSoFar+=panelCalculated)}return panel.expandFor(-1*panelCalculated),panel.offset(-1*offsetSoFar),panel.animate(),void(offsetSoFar+=panelCalculated)}panel.expandFor(0),panel.offset(-1*(panelCalculated+offsetSoFar)),panel.animate(),offsetSoFar+=panelCalculated})}},add:function(options,after_id){var panel=new MU.Panel(options),beforeSize=0,stackIndex=0;if(this.panelsStack.get(panel.id()))throw new Error("Duplicated ID: "+panel.id());return after_id?(beforeSize=this.panelsStack.get(after_id).width(),this.panelsStack.eachBefore(after_id,function(index,panelInside){panelInside.zIndex(1e4-index),beforeSize+=panelInside.width()})):beforeSize=this.sumSize,panel.position(beforeSize),this.updateSum(panel.width()),after_id?(this.panelsStack.get(after_id).zIndex(1e4-this.panelsStack.getIndex(after_id)),stackIndex=this.panelsStack.pushAfter(after_id,panel.id(),panel)):stackIndex=this.panelsStack.push(panel.id(),panel),panel.zIndex(1e4-("full"===panel.size()?-1*stackIndex:stackIndex)),this.activeId&&this.panelsStack.get(this.activeId).width()&&!panel.width()||this.focus(panel.id(),!1),panel.expand()&&this.fillCount++,after_id&&panel.id()!==this.panelsStack.getLast().id()&&this.panelsStack.eachAfter(panel.id(),function(index,panelInside){panelInside.zIndex(1e4-index),panelInside.position(panelInside.position()+panel.width()),panelInside.animate()}),this.refreshView(),panel.element.css({opacity:0,left:panel.position()+panel.offset()-(panel.width()+panel._s.expandedFor)}),this.parent.append(panel.element),panel.animate(),panel},remove:function(id){if(this.panelsStack.get(id)){var panel=this.panelsStack.get(id),width=panel.width(),that=this;if(!panel.locked()){if(panel.insensitive(!0),id===this.activeId&&(this.activeId=!1),panel.getChildren().length)for(var i=panel.getChildren().length-1;i>=0;i--)this.remove(panel.getChildren()[i].id(),!1);panel.expand()&&this.fillCount--,this.updateSum(-1*width),panel.element.animate({left:panel._s.position+panel._s.offset-(width+panel._s.expandedFor)-10,opacity:0},"normal",function(){panel.element.remove()}),this.panelsStack.eachAfter(id,function(index,panelInside){that.offseted?panelInside.position(panelInside.position()-width):(panelInside.position(panelInside.position()-width),panelInside.animate())}),this.focusNext(id),this.panelsStack.remove(id),this.refreshView()}}},get:function(id){return this.panelsStack.get(id)?this.panelsStack.get(id):void 0},focusNext:function(lastId){var focusTo=this.panelsStack.getFrom(lastId,-1);(focusTo&&!focusTo.insensitive()||(focusTo=this.panelsStack.each(function(id,panel){return panel.insensitive()?void 0:panel})))&&this.focus(focusTo.id(),!1)},focus:function(id,refresh){if(id===this.activeId)return!0;var panel=this.panelsStack.get(id);panel.insensitive()||(this.activeId&&this.panelsStack.get(this.activeId).focus(!1),panel.focus(!0),this.activeId=id,refresh===!0&&this.refreshView())}},MU.Panels=Panels}(Zepto,MU);