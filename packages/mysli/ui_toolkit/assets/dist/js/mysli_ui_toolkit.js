!function($,MU){"use strict";var count=0,dimensions={tiny:160,small:260,medium:500,big:800},Panel=function(options){options=$.extend({},{size:"small",front:{},back:{},expand:!1,flippable:!1,closable:!0,shrink:!1,id:!1,position:0},options),this._s={},this._s.position=options.position,this._s.offset=0,this._s.locked=!1,this._s.expand=options.expand,this.shrink(options.shrink?options.shrink:!1),this._s.expandFor=0,this._s.size="undefined"==typeof dimensions[options.size]?"small":options.size,this._s.width=dimensions[this._s.size],this._s.children=[],this._s.away=!1,this._s.awayOnBlur=!1,this._s.awayWidth=10,this._s.insensitive=!1,this._s.busy=!1,this._s.full=!1,this._s.oldZIndex=0,options.id=options.id?options.id:"mu-panel-"+count,this.element=function(){var wrapper=$('<div class="panel multi" id="'+options.id+'" />'),sides=$('<div class="sides" />').appendTo(wrapper);return wrapper.width(this._s.width+"px"),options.front.id=options.id+"-side-front",this.front=new MU.PanelSide(options.front),this.front.style("front"),options.closable&&this.front.header_add("close",{icon:"times",type:"link",action:"self/close",preventDefault:!0}),options.front.title&&this.front.header_add("title",{label:options.front.title,type:"title"}),sides.append(this.front.element),options.flippable?(options.back.id=options.id+"-side-back",this.back=new MU.PanelSide(options.back),this.back.style("back alt"),this.back.header_add("close",{icon:"arrow-left",type:"link",action:"self/flip"}),options.back.title&&this.back.header_add("title",{label:options.front.title,type:"title"}),sides.append(this.back.element)):(this.back=!1,sides.append('<div class="dummy"/>')),wrapper}.call(this),this._s.closing=!1,count++};Panel.prototype={constructor:Panel,flip:function(){this.back&&this.element.toggleClass("flipped")},away:function(value,refresh){var width;if(void 0===value)return this._s.away;if(value){if(this.focus()||this._s.away)return void(this._s.awayOnBlur=!0);this._s.away=!0,width=-(this.width()-this._s.awayWidth)}else{if(!this._s.away)return void(this._s.awayOnBlur=!1);this._s.away=!1,this._s.awayOnBlur=!1,width=this.width()-this._s.awayWidth}$(document).trigger("MU/panels/updateSum",[width]),(void 0===refresh||refresh===!0)&&$(document).trigger("MU/panels/refresh")},full:function(value){return void 0===value?this._s.full:void(value!==this._s.full&&(value?(this._s.full=!0,$(document).trigger("MU/panels/focus",[this.id()]),this._s.oldZIndex=this.element.css("z-index"),this.element.css("z-index",1e4),this.element.animate({left:0,width:"100%"})):(this._s.full=!1,this.animate(function(){this.element.css("z-index",this._s.oldZIndex)}))))},insensitive:function(value){return void 0===value?this._s.insensitive:void(value?this.focus()?(this.blur(),this._s.insensitive=!0,$(document).trigger("MU/panels/focusNext",[this.id()])):this._s.insensitive=!0:this._s.insensitive=!1)},busy:function(value){if(void 0===value)return this._s.busy;if(value){if(this._s.busy)return;var busy=$('<div class="loading panel-busy" style="opacity:0;" />').prependTo(this.element);busy.animate({opacity:.75}),this._s.busy=!0}else{if(!this._s.busy)return;this.element.find("div.panel-busy").fadeOut(400,function(){this.remove()}),this._s.busy=!1}},animate:function(callback){if(!this._s.closing){var _this=this;this.element.animate({left:this._s.position+this._s.offset,width:this._s.width+this._s.expandFor,opacity:1},400,"ease",function(){"function"==typeof callback&&callback.call(_this)})}},locked:function(value){return void 0===value?this._s.locked:void(this._s.locked=!!value)},offset:function(offset){return void 0===offset?this._s.offset:void(this._s.offset=offset)},position:function(position){return void 0===position?this._s.position:void(this._s.position=position)},expand:function(value){return void 0===value?this._s.expand:void(this._s.expand=!!value)},expandFor:function(width){return void 0===width?this._s.expandFor:void(this._s.expandFor=width)},shrink:function(value){return void 0===value?this._s.shrink:void(this._s.shrink=value===!1?!1:dimensions[value]?dimensions[value]:dimensions.tiny)},size:function(value){if(void 0===value)return this._s.size;var sizeDiff=0;this._s.size="undefined"==typeof dimensions[value]?"small":value,sizeDiff=-(this._s.width-dimensions[this._s.size]),this._s.width=dimensions[this._s.size],this.animate(),$(document).trigger("MU/panels/updateSum",[sizeDiff,this.id()]),$(document).trigger("MU/panels/refresh")},width:function(){return this._s.width},id:function(id){return void 0===id?this.element.prop("id"):void this.element.prop("id",id)},addChild:function(child){this._s.children.push(child)},getChildren:function(){return this._s.children},zIndex:function(value){return void 0===value?this.element.css("z-index"):void this.element.css({"z-index":value})},blur:function(){this.element.removeClass("selected"),this._s.awayOnBlur&&this.away(!0,!1)},focus:function(){return this.element.hasClass("selected")}},MU.Panel=Panel}(Zepto,MU);