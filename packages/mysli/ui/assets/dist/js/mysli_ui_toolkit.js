!function($,MU){"use strict";function calculateTargetPosition(target){var result={top:{},left:{}};if("undefined"!=typeof target.pageX)result={top:{min:target.pageY,max:target.pageY},left:{min:target.pageX,max:target.pageX}};else if("function"==typeof target.offset)result={top:{min:target.offset().top,max:target.offset().top+target.height()},left:{min:target.offset().left,max:target.offset().left+target.width()}};else if("number"==typeof target.top)result={top:{min:target.top,max:target.top},left:{min:target.left,max:target.left}};else{if("object"!=typeof target.top)throw new Error("Invalid target!");result=target}return result.top.mid=result.top.min+(result.top.max-result.top.min)/2,result.left.mid=result.left.min+(result.left.max-result.left.min)/2,result}function getMidPosition(result,where,targetPosition,elementDimension,elementDimensionHalf,parentDimension,spacing){var diff={min:0,max:0}.result={};return diff.min=targetPosition-elementDimensionHalf,diff.max=parentDimension-(targetPosition+elementDimensionHalf),-diff.min>elementDimensionHalf-8||-diff.max>elementDimensionHalf-8?!1:diff.min>=spacing?(diff.max<=spacing?(result.pointerDiff=-diff.max,result[where]=parentDimension-spacing-elementDimension):result[where]=diff.min,!0):targetPosition+elementDimensionHalf-diff.min<parentDimension?(result[where]=spacing,result.pointerDiff=diff.min,!0):void 0}function getElementPlacement(placementOrder,targetPosition,parentDimension,elementDimension){for(var result={pointerDiff:0},targetSpacing=10,i=0,len=placementOrder.length;len>i;i++)switch(placementOrder[i]){case"top":if(result.position="down",targetPosition.top.min-elementDimension.height-2*targetSpacing>=0&&(result.top=targetPosition.top.min-elementDimension.height-targetSpacing,getMidPosition(result,"left",targetPosition.left.mid,elementDimension.width,Math.round(elementDimension.width/2),parentDimension.width,targetSpacing)))return result;continue;case"bottom":if(result.position="up",targetPosition.top.max+elementDimension.height+2*targetSpacing<parentDimension.height&&(result.top=targetPosition.top.max+targetSpacing,getMidPosition(result,"left",targetPosition.left.mid,elementDimension.width,Math.round(elementDimension.width/2),parentDimension.width,targetSpacing)))return result;continue;case"left":if(result.position="right",targetPosition.left.min-elementDimension.width-2*targetSpacing>=0&&(result.left=targetPosition.left.min-elementDimension.width-targetSpacing,getMidPosition(result,"top",targetPosition.top.mid,elementDimension.height,Math.round(elementDimension.height/2),parentDimension.height,targetSpacing)))return result;continue;case"right":if(result.position="left",targetPosition.left.max+elementDimension.width+2*targetSpacing<parentDimension.width&&(result.left=targetPosition.left.max+targetSpacing,getMidPosition(result,"top",targetPosition.top.mid,elementDimension.height,Math.round(elementDimension.height/2),parentDimension.height,targetSpacing)))return result;continue}}var Popup=function(options){options=options||{},"string"==typeof options.position&&(options.position=[options.position,"bottom","top","left","right"]),this.properties=$.extend({},{spaced:!0,position:["bottom","top","left","right"],content:null,pointerSpace:-8,visible:!1,style:null,trigger:null,event:"click",toggle:!0,delay:0,selfClose:!0,sticky:!1},options);var delayTimer=null;if(this.element=$('<div class="popup point" style="display:none;"><div class="pointer" /><div class="contents" /></div>'),this.element.appendTo("body"),this.properties.content&&this.content(this.properties.content),this.properties.style&&this.style(this.properties.style),this.spaced(this.properties.spaced),this.properties.visible&&this.show(),this.properties.selfClose?this.element.on("click",this.hide.bind(this)):this.element.on("click",function(e){e.stopPropagation()}),!this.sticky&&this.properties.trigger&&$(document).on("click",function(){this.properties.visible&&this.hide()}.bind(this)),this.properties.trigger&&this.properties.event)if("click"===this.properties.event)this.properties.trigger.on("click",function(e){return e.preventDefault(),e.stopPropagation(),this.properties.visible?void(this.properties.toggle&&this.hide()):void(this.properties.delay?(clearTimeout(delayTimer),delayTimer=setTimeout(function(){this.show()}.bind(this),this.properties.delay)):this.show())}.bind(this));else{if("mouseover"!==this.properties.event)throw new Error('Unsupported event. Allowed are: "click" and "mouseover".');this.properties.trigger.on("mouseover",function(){this.properties.visible||(this.properties.delay?(clearTimeout(delayTimer),delayTimer=setTimeout(function(){this.show()}.bind(this),this.properties.delay)):this.show())}.bind(this)),this.properties.toggle&&this.properties.trigger.on("mouseout",function(){this.properties.delay?(clearTimeout(delayTimer),delayTimer=setTimeout(function(){this.hide()}.bind(this),this.properties.delay)):this.hide()}.bind(this))}};Popup.prototype={constructor:Popup,updatePosition:function(targetPosition){var elementPlacement,pointerPosition,elementDimension={width:this.element.width(),height:this.element.height()},windowDimension={width:$(window).width(),height:$(window).height()+$(window).scrollTop()};elementPlacement=getElementPlacement(this.properties.position,calculateTargetPosition(targetPosition),windowDimension,elementDimension),elementPlacement&&(this.element.css({top:elementPlacement.top,left:elementPlacement.left}),this.element.removeClass("up down left right"),this.element.addClass(elementPlacement.position),pointerPosition="left"===elementPlacement.position||"right"===elementPlacement.position?{marginTop:elementPlacement.pointerDiff+this.properties.pointerSpace+"px",marginLeft:"0px"}:{marginTop:"0px",marginLeft:elementPlacement.pointerDiff+this.properties.pointerSpace+"px"},this.element.find(".pointer").css(pointerPosition))},show:function(targetPosition){this.properties.trigger&&(targetPosition=this.properties.trigger),this.element.fadeIn(200),this.updatePosition(targetPosition),this.properties.visible=!0},hide:function(){this.element.fadeOut(200),this.properties.visible=!1},toggle:function(e){this[this.properties.visible?"hide":"show"](e)},content:function(value){this.element.find(".contents").html(value)},spaced:function(value){this.element[value?"addClass":"removeClass"]("spaced")},style:function(variant){var classes=["alt"];if("undefined"==typeof variant){for(var i=classes.length-1;i>=0;i--)if(this.element.hasClass(classes[i]))return classes[i];return"default"}this.element.removeClass(classes.join(" ")),"default"!==variant&&this.element.addClass(variant)}},MU.Popup=Popup}(Zepto,Mysli.UI);