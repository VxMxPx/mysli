mysli="object"==typeof mysli?mysli:{},mysli.web="object"==typeof mysli.web?mysli.web:{},mysli.web.ui="object"==typeof mysli.web.ui?mysli.web.ui:{},mysli.web.ui._=function(){"use strict";var uidc=0;return{extend:{},uid:function(element){var uuid="muid-"+ ++uidc;return element.addClass(uuid),uuid},use:function(options,context,methods){var arg,call,expect,params,_i,_len;null===methods&&(methods={});for(call in methods){if(expect=methods[call],params=[],"string"==typeof expect)params.push(options[expect]);else for(_i=0,_len=expect.length;_len>_i;_i++)arg=expect[_i],params.push(options[arg]);context[call].apply(context,params)}},merge:function(defaults,options){return $.extend({},defaults,options)},number_format:function(number,decimals,dec_point,thousands_sep){var n,prec,s,to_fixed_fix;return null===dec_point&&(dec_point="."),null===thousands_sep&&(thousands_sep=","),number=(number+"").replace(/[^0-9+\-Ee.]/g,""),n=isFinite(+number)?+number:0,prec=isFinite(+decimals)?Math.abs(decimals):0,s="",to_fixed_fix=function(n,prec){var k;return k=Math.pow(10,prec),""+Math.round(n*k)/k},s=prec?to_fixed_fix(n,prec):""+Math.round(n),s=s.split("."),s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,thousands_sep)),(s[1]||"").length<prec&&(s[1]=s[1]||"",s[1]+=new Array(prec-s[1].length+1).join("0")),s.join(dec_point)},get_percent:function(amount,total,percision){var count;return"number"==typeof amount&&"number"==typeof total?(percision=percision||2,amount&&total?(count=amount/total,count=100*count,count=parseFloat(this.number_format(count,percision))):amount):!1},set_percent:function(percent,total,percision){var result;return"number"==typeof percent&&"number"==typeof total?(percision=percision||2,percent&&total?result=parseFloat(this.number_format(total/100*percent,percision)):0):!1}}}(),mysli.web.ui._.extend.style=function(allowed,call){return"undefined"==typeof call&&(call="style"),function(style){var classes,i,current;if("undefined"!=typeof style){if(this.$element.removeClass(this[call]()),!(style in allowed))throw new Error("Invalid style: `"+style+"`, please use one of the following: "+allowed.join(", "));this.$element.addClass("style-"+style)}else for(classes=this.$element.className.split(" "),i=classes.length-1;i>=0;i--)if("style-"===classes[i].substr(0,6)&&(current=classes[i].substr(6),current in allowed))return current}},mysli.web.ui._.extend.disable=function(state){return"undefined"==typeof state?this.$element.prop("disabled"):void this.$element.prop("disabled",!!state)},mysli.web.ui._.extend.flat=function(value){return"undefined"==typeof value?this.$element.hasClass("style-flat"):void(value?this.$element.addClass("style-flat"):this.$element.removeClass("style-flat"))},mysli.web.ui._.extend.event=function(events){"use strict";var dom_native=["click","mouse-enter","mouse-leave","mouse-move","mouse-out","mouse-over","mouse-up"],event=function(events,parent){this.events={},this.counter=0,this.use_native=!1,this.count_native={},this.parent=parent,"<native>"===events[0]&&(this.use_native=!0,events=events.slice(1),events=events.concat(dom_native));for(var i=events.length-1;i>=0;i--)this.events[events[i]]={}};return event.prototype={constructor:event,trigger:function(event,params){var call,id,_results;if(null===params&&(params=[]),"undefined"==typeof this.events[event])throw new Error("Invalid event: "+event);if("function"!=typeof params.push)throw new Error("Params needs to be an array!");params.push(this),_results=[];for(id in this.events[event])if(this.events[event].hasOwnProperty(id)){if(call=this.events[event][id],"function"!=typeof call)throw new Error("Invalid type of callback: "+id);_results.push(call.apply(this,params))}return _results},connect:function(event,callback){var id,_ref;if(_ref=this.extract_event_name(event),event=_ref[0],id=_ref[1],"undefined"==typeof this.events[event])throw new Error("No such event available: "+event);return this.counter++,id=""+id+event+"--"+this.counter,this.events[event][id]=callback,this.use_native&&"undefined"!=typeof dom_native[event]&&(this.count_native[event]="undefined"==typeof this.count_native[event]?0:this.count_native[event]+1,1===this.count_native[event]&&(dom_event=event.replace("-",""),this.parent.$element.on(dom_event,this.trigger.bind(this,event)))),id},disconnect:function(id){var eid,event;if("object"!=typeof id&&"*"===id.substr(0,1)){id+="*";for(event in this.events)for(eid in this.events[event])eid.substr(0,id.length)===id&&(this.disconnect_native(event),delete this.events[event][eid]);return!0}return"object"!=typeof id?event=id.split("--",2)[0]:(event=id[0],id=id[1]),"undefined"!=typeof this.events[event]?(this.disconnect_native(event),delete this.events[event][id]):!1},extract_event_name:function(event){var id;return event.indexOf("*")>0?(id=event.split("*",2),event=id[0],id="*"+id[1]+"*"):id="",[event,id]},disconnect_native:function(event){this.use_native&&"undefined"!=typeof dom_native[event]&&(this.count_native[event]="undefined"==typeof this.count_native[event]?0:this.count_native[event]-1,0===this.count_native[event]&&(dom_event=event.replace("-",""),this.parent.$element.off(dom_event)))}},new event(events,this)},mysli.web.ui.button=function(){"use strict";var ui=mysli.web.ui,template='<button class="ui-button ui-widget" />',button=function(label,options){"string"==typeof label?options.label=label:options=label,this._=ui._.merge({label:null,icon:{name:null,position:"left",spin:!1},style:"default",flat:!1},options),this.$element=$(template),ui.use(this.options,this,{label:"label",icon:"icon",style:"style",flat:"flat",disabled:"disabled"}),this.uid=us._.uid(this.$element)};return button.prototype={constructor:button,event:ui._.extend.event(["<native>"]),style:ui._.extend.style(["default","alt","primary","confirm","attention"]),disabled:ui._.extend.disabled,flat:ui._.extend.flat,label:function(value){var method,$label=this.$element.find("span.label");return"undefined"==typeof value?$label.text():(value||$label.remove(),$label.length||($label=$('<span class="label" />'),method="right"===this._.icon.position?"prepend":"append",this.$element[method]($label)),$label.text(value),void 0)},icon:function(icon){var $icon,method,spin;return"undefined"==typeof icon?this._.icon:($icon=this.$element.find("i.fa"),$icon.remove(),icon!==!1&&("string"==typeof icon?this._.icon.name=icon:this._.icon=ui._.merge(this._.icon,icon),method="right"===this._.icon.position?"append":"prepend",spin=this._.icon.spin?" fa-spin":"",this.$element[method]($('<i class="fa fa-'+this._.icon.name+spin+'" />'))),void 0)}},button}(),mysli.web.ui.box=function(){"use strict";var ui=mysli.web.ui,template='<div class="ui-box ui-widget" />',box=function(options){if(this.$element=$(template),this.uid=ui._.uid(this.$element),this._=ui._.merge({orientation:"horizontal"},options),"vertical"===this.orientation){var row=$('<div class="row" />');this.$element.append(row),this.$target=row}else this.$target=this.$element};return box.prototype={constructor:box,event:ui._.extend.event(["<native>"]),add:function(widget,prepend,expand){var expanded=expand?"expanded":"collapsed",method=prepend?"prepend":"append",uid="mwub-"+widget.uid,wrapper=null;return"horizontal"===this.orientation?(wrapper=$('<div class="row '+expanded+" "+uid+'" />'),$('<div class="cell" />').append(widget.$element).appendTo(wrapper)):wrapper=$('<div class="cell '+expanded+" "+uid+'" />'),this.$target[method](wrapper),uid},remove:function(selector){"object"==typeof selector&&(selector="mwub-"+selector.uid),this.$target.find(selector).remove()}},box}(),mysli.web.ui.panel=function(){"use strict";var ui=mysli.web.ui,template='<div class="ui-panel ui-widget" />',dimensions={tiny:160,small:260,normal:340,big:500,huge:800},panel=function(options){this.$element=$(template),this.connected=[],this._=ui._.merge({position:0,offset:0,locked:!1,expandable:!1,expanded_for:0,min_size:!1,size:"normal",width:0,away:!1,away_on_blur:!1,away_width:10,insensitive:!1,popout:!1,focused:!1,flippable:!1},options),this.closing=!1,this.old_zindex=0,this.old_width=0,ui._.use(this._,this,{min_size:"min_size",size:"size"}),this.$element.on("click",this.focus.bind(this,!0)),this.front=new ui.panel_side,this.$element.append(this.front.$element),this._.flippable?(this.back=new ui.panel_side({style:"alt"}),this.$element.append(this.back.$element)):this.back=!1,this.uid=ui._.uid(this.$element)};return panel.prototype={constructor:panel,event:ui._.extend.event(["<native>","away-change","size-change","popout-change","insensitive-change","min-size-change","focus-change","expandable-change"]),animate:function(callback){this.closing||this.$element.stop(!0,!1).animate({left:this._.position+this._.offset,width:this._.width+this._.expanded_for,opacity:1},400,"swing",function(){"function"==typeof callback&&callback.call(this)})},size:function(value){if("undefined"==typeof value)return{width:this._.width,height:0,size:this._.size};var diff=0,newsize={};if("undefined"==typeof dimensions[value])throw new Error("Invalid value for size: "+value);this._.size=value,diff=-(this._.width-dimensions[value]),this._.width=dimensions[value],newsize=this.size(),newsize.diff=diff,this.event.trigger("size-change",newsize)},away:function(status){if("undefined"==typeof status)return this._.away;var width=null;if(status){if(this.focus()||this.away())return void(this._.away_on_blur=!0);this._.away=!0,width=-(this._.width-this._.away_width)}else{if(!this._.away)return void(this._.away_on_blur=!1);this._.away=!1,this.away_on_blur=!1,width=this._.width-this._.away_width}this.event.trigger("away-change",[status,width])},popout:function(status,size){return"undefined"==typeof status?this._.popout:void(status!==this.popout()&&(status?("undefined"==typeof size&&(size="huge"),this._.popout=!0,this.focus(!0),this.old_zindex=this.$element.css("z-index"),this.old_width=this._.width,this.$element.css("z-index",10005),this._.width=dimensions[size],this.animate()):(this._.popout=!1,this.$element.css("z-index",this.old_zindex),this._.width=this.old_width),this.event.trigger("popout-change",[status])))},insensitive:function(value){return"undefined"==typeof value?this._.insensitive:(value?(this.focus()&&this.focus(!1),this._.insensitive=!0):this._.insensitive=!1,void this.event.trigger("insensitive-change",[value]))},min_size:function(size){if("undefined"==typeof size)return this._.min_size;if(size&&"undefined"==typeof dimensions[size])throw new Error("Not a valid size value: "+size);this._.min_size=size?dimensions[size]:!1,this.event.trigger("min-size-change",[size,dimensions[size]])},focus:function(value){return"undefined"==typeof value?this._.focused:void(value!=this._.focused&&(value?(this._.focused=!0,this.$element.addClass("focused"),this.away()&&(this.away(!1),this._.away_on_blur=!0)):(this._.focused=!1,this.$element.removeClass("focused"),this._.away_on_blur&&this.away(!0)),this.event.trigger("focus-change",[value])))},expandable:function(value){return"undefined"==typeof value?this._.expandable:(this._.expandable=value,void this.event.trigger("expandable-change",[value]))},close:function(){this._.locked||(this._.insensitive=!0,this._.closing=!0,this.$element.stop(!0,!1).animate({left:this._.position+this._.offset-(this.size().width+this._.expanded_for)-10,opacity:0},400,"swing"))}},panel}(),mysli.web.ui.panel_container=function(){"use strict";var ui=mysli.web.ui,template='<div class="ui-widget ui-panel-container" />',panel_container=function(){this.$element=$(template),this.uid=ui._.uid(this.$element),this.sum_size=0,this.expandable_count=0,this.active_id=!1,this.offseted=0,this.container_width=0,this.panels=new ui._.arr,this.resize_timer=null,this.set_resize_with_window(!0),this.set_size_from_dom_element(window)};return panel_container.prototype={constructor:panel_container,event:ui._.extend.event(["<native>"]),update_sum:function(value,modify_before_id){this.sum_size=this.sum_size+value,"undefined"!=typeof modify_before_id&&this.panels.each_after(modify_before_id,function(index,panel){panel.$element.css("z-index",1e4-index),panel._.position=panel._.position+value,panel.animate()})},update_view:function(){var active_panel,overflow,overflow_part,overflow_percent,screen_left,offset_so_far,panel_calculated,diff;this.active_id&&(active_panel=this.get(this.active_id),overflow=this.container_width-this.sum_size,overflow_part=this.expandable_count>0?Math.ceil(overflow/this.expandable_count):0,screen_left=this.container_width-active_panel.size().width,overflow_percent=100-ui._.get_percent(screen_left,this.sum_size-active_panel.size().width),offset_so_far=0,panel_calculated=0,0>=overflow_part&&(overflow_part=overflow),overflow>0?(overflow_percent=0,this.offseted=!1):this.offseted=!0,this.panels.each(function(index,panel){if(panel.away()&&!panel.focus())return panel._.expanded_for=0,panel._.offset=-(panel.size().width-panel._.away_width+offset_so_far),panel.animate(),void(offset_so_far=offset_so_far+panel.size().width-panel._.away_width);if(panel.expandable()){if(overflow>0)return panel._.offset=-offset_so_far,panel._.expanded_for=overflow_part,panel.animate(),void(offset_so_far+=-overflow_part);panel._.expanded_for=0,panel.animate()}return panel.focus()?(panel._.expanded_for=0,panel._.offset=-offset_so_far,void panel.animate()):(panel_calculated=ui._.set_percent(overflow_percent,panel.size().width),panel.min_size()&&panel.size().width+panel._.expanded_for>panel.min_size()?panel.min_size()>panel.size().width-panel_calculated?(diff=panel_calculated-(panel.size().width-panel.min_size()),panel._.expanded_for=-diff,panel._.offset=-(panel_calculated-diff+offset_so_far),panel.animate(),void(offset_so_far+=panel_calculated)):(panel._.expanded_for=-panel_calculated,panel._.offset=-offset_so_far,panel.animate(),void(offset_so_far+=panel_calculated)):(panel._.expanded_for=0,panel._.offset=-(panel_calculated+offset_so_far),panel.animate(),void(offset_so_far+=panel_calculated)))}))},add:function(panel,after_id){var index;if(panel instanceof mysli.web.ui.panel)throw new Error("An object must be instance of `mysli.web.ui.panel`");"string"==typeof after_id?(size=this.get(after_id).size().width,this.panels.each_before(after_id,function(index,ipanel){ipanel.$element.css("z-index",1e4-index),size+=ipanel.size().width}),panel._.position=size):panel._.position=this.sum_size,this.update_sum(panel.size().width),panel.$element.css({opacity:0,left:panel._.position+panel._.offset-(panel.size().width+panel._.expanded_for)}),after_id?(this.panels.push_after(after_id,panel.uid,panel),panel.uid!==this.panels.get_last().uid&&this.panels.each_after(panel.uid,function(index,ipanel){ipanel.$element.css("z-index",1e4-index),ipanel._.position=ipanel._.position+panel.size().width,ipanel.animate()})):this.panels.push(panel.uid,panel),index=this.panels.get_index(panel.uid),panel.$element.css("z-index",1e4-index),panel.connect("focus-change",this.switch_focus.bind(this)),panel.focus(!0),panel.expandable()&&this.expandable_count++},get:function(id){return this.panels.get(id)},remove:function(id){var new_panel,panel=this.get(id),width=panel.size().width;panel.expandable()&&this.expandable_count--,this.update_sum(-width,id),id==this.active_id?(this.active_panel=!1,new_panel=this.panels.get_from(id,-1),this.panels.remove(id),new_panel.focus(!0)):(this.panels.remove(id),this.update_view())},set_resize_with_window:function(status,timeout){"undefined"==typeof timeout&&(timeout=500),status?$(window).on("resize",function(){this.resize_timer&&clearTimeout(this.resize_timer),this.resize_timer=setTimeout(this.set_size_from_dom_element.bind(this,window),timeout)}.bind(this)):this.resize_timer&&clearTimeout(this.resize_timer)},set_size_from_dom_element:function(selector){var width=$(selector).outerWidth(),height=$(selector).outerHeight();this.$element.css({width:width,height:height}),this.container_width=width,this.update_view()},switch_focus:function(status,panel){status&&(this.active_id!==!1&&this.get(this.active_id).focus(!1),this.active_id=panel.uid,this.update_view())}},panel_container}(),mysli.web.ui.panel_side=function(){"use strict";var ui=mysli.web.ui,template='<div class="ui-widget ui-panel-container ui-panel-side" />',panel_side=function(options){this.$element=$(template),this.uid=ui._.uid(this.$element),ui._.use(options,this,{style:"style"})};return panel_side.prototype={constructor:panel_side,event:ui._.extend.event(["<native>"]),style:ui._.extend.style(["default","alt"])},panel_side}(),mysli.web.ui.html=function(){"use strict";var ui=mysli.web.ui,template='<div class="ui-html ui-widget" />',html=function(){this.$element=$(template),this.uid=ui._.uid(this.$element)};return html.prototype={add:function(content){this.$element.append(content)}},html}(),mysli.web.ui.titlebar=function(){"use strict";var ui=mysli.web.ui,template='<div class="ui-widget ui-titlebar" />',titlebar=function(){this.$element=$(template),this.uid=ui._.uid(this.$element),this.$target=this.$element,this._.orientation="horizonatal"};return titlebar.prototype={constructor:titlebar,event:ui._.extend.event(["<native>"]),add:ui.box.add,remove:ui.box.remove,flat:ui._.extend.flat},titlebar}(),mysli.web.ui.title=function(){"use strict";var ui=mysli.web.ui,template='<span class="ui-widget ui-title" />',title=function(text,options){"object"!=typeof options&&(options={}),"object"==typeof text?options=text:options.text=text,this._=ui._.merge({text:null,level:1},options),this.$element=$(template),this.uid=ui._.uid(this.$element),ui._.use(this._,this,{level:"level",text:"text"})};return title.prototype={constructor:title,event:ui._.extend.event(["<native>"]),level:function(value){if("undefined"==typeof value)return this._.level;if(1>value||value>6)throw new Error("Level needs to be a numeric value between 1 and 6.");this._.level=value,this.$element.html("<h"+value+" />"),this.text(this._.text)},text:function(value){return"undefined"==typeof value?this._.text:(this._.text=value,void this.$element.find(":first-child").text(value))}},title}(),mysli.web.ui.overlay=function(){"use strict";var ui=mysli.web.ui,template='<div class="ui-overlay ui-widget"><div class="ui-overlay-busy"><i class="fa fa-cog fa-spin"></i></div></div>',overlay=function(){this.$element=$(template),this.uid=ui._.uid(this.$element)};return overlay.prototype={constructor:overlay,event:ui._.extend.event(["<native>"]),busy:function(state){"undefined"!=typeof state?state?this.$element.addClass("state-busy"):this.$element.removeClass("state-busy"):this.$element.hasClass("state-busy")},visible:function(status){return"undefined"==typeof status?this.$element.is(":visible"):void(status?this.$element.fadeIn():this.$element.fadeOut(400))}},overlay}(),mysli.web.ui.navigation=function(){"use strict";var ui=mysli.web.ui,template='<div class="ui-widget ui-navigation" />',template_item='<div class="ui-navigation-item" />',navigation=function(){this.$element=$(template),this.uid=ui._.uid(this.$element),this.items={},this.$element.on("click",".ui-navigation-item",function(e){var id;e.stopPropagation(),id=e.currentTarget.id.substr(6),this.event.trigger("action",[id])}.bind(this))};return navigation.prototype={constructor:navigation,event:ui._.extend.event(["<native>","action"]),style:ui._.extend.style(["default","alt"]),add:function(id,options){var $item,button;"string"==typeof options&&(options={label:options}),$item=$(template_item),$item.attr("id","ui-nav-item-id-"+id),button=new ui.button(options),$item.append(button.$element),this.items[id]=button,this.$element.append($item)},get:function(id){return this.items[id]},remove:function(id){delete this.items[id],this.$element.find("#ui-nav-item-id-"+id).remove()}},navigation}();